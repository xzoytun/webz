<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XT VPN Panel - Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0b1e;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #e5e7eb;
      position: relative;
    }

    /* Glow background biar nyambung sama welcome & login */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 20% 30%, rgba(102,126,234,0.18) 0%, transparent 55%),
        radial-gradient(circle at 80% 70%, rgba(237,100,166,0.18) 0%, transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(118,75,162,0.15) 0%, transparent 60%);
      z-index: 0;
      pointer-events: none;
    }

    .dashboard-header {
      background: rgba(15, 16, 41, 0.96);
      backdrop-filter: blur(20px);
      padding: 18px 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
      flex-shrink: 0;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(129, 140, 248, 0.35);
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #ed64a6 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 8px 20px rgba(129, 140, 248, 0.6);
    }

    .dashboard-header h2 {
      background: linear-gradient(135deg, #ffffff 0%, #a5b4fc 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.5px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .user-email {
      color: #e5e7eb;
      font-size: 13px;
      font-weight: 500;
      padding: 8px 14px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
    }

    .btn-logout {
      background: linear-gradient(135deg, #f97373 0%, #ef4444 100%);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 8px 20px rgba(239,68,68,0.5);
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(239,68,68,0.7);
    }

    .app-container {
      display: flex;
      flex: 1;
      overflow: hidden;
      padding: 24px;
      gap: 24px;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
      position: relative;
      z-index: 1;
    }

    .hamburger {
      display: none;
    }

    .app-nav {
      background: rgba(15, 16, 41, 0.96);
      backdrop-filter: blur(20px);
      width: 280px;
      padding: 24px;
      border-radius: 24px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.7);
      overflow-y: auto;
      flex-shrink: 0;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .nav-section-title {
      color: #9ca3af;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      padding-left: 16px;
    }

    .nav-btn {
      width: 100%;
      padding: 14px 18px;
      border: none;
      background: transparent;
      text-align: left;
      border-radius: 14px;
      cursor: pointer;
      font-size: 14px;
      color: #e5e7eb;
      margin-bottom: 6px;
      transition: all 0.25s;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .nav-btn::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(135deg, #667eea 0%, #ed64a6 100%);
      transform: scaleY(0);
      transform-origin: top;
      transition: transform 0.25s;
    }

    .nav-btn:hover {
      background: rgba(55, 65, 81, 0.8);
      transform: translateX(3px);
    }

    .nav-btn.active {
      background: linear-gradient(135deg, rgba(79,70,229,0.9) 0%, rgba(147,51,234,0.9) 100%);
      color: #fff;
      box-shadow: 0 10px 28px rgba(79,70,229,0.6);
    }

    .nav-btn.active::before {
      transform: scaleY(1);
    }

    .app-content {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }

    .app-page {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .app-page.active {
      display: block;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .page-title {
      color: #f9fafb;
      font-size: 30px;
      font-weight: 800;
      margin-bottom: 10px;
      text-shadow: 0 2px 12px rgba(15,23,42,0.9);
    }

    .page-subtitle,
    .muted {
      color: #9ca3af;
      font-size: 14px;
    }

    .small {
      font-size: 13px;
    }

    /* ===== SERVICE CARDS ===== */
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }

    .service-card {
      background: radial-gradient(circle at top left, rgba(129,140,248,0.22), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(236,72,153,0.18), transparent 55%),
                  rgba(15,23,42,0.96);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 24px 22px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.8);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      border: 1px solid rgba(148,163,184,0.45);
      position: relative;
      overflow: hidden;
    }

    .service-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #6366f1 0%, #ec4899 50%, #a855f7 100%);
      opacity: 0;
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.25s, opacity 0.25s;
    }

    .service-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 24px 60px rgba(15,23,42,0.95);
      border-color: rgba(196,181,253,0.7);
    }

    .service-card:hover::before {
      opacity: 1;
      transform: scaleX(1);
    }

    .service-icon {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      margin-bottom: 16px;
      box-shadow: 0 12px 30px rgba(99,102,241,0.7);
      color: #fff;
    }

    .service-card h4 {
      color: #f9fafb;
      margin-bottom: 10px;
      font-size: 18px;
      font-weight: 700;
    }

    .service-card p {
      color: #9ca3af;
      font-size: 14px;
      line-height: 1.7;
      margin-bottom: auto;
      min-height: 60px;
    }

    .service-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .service-cta,
    .service-cta-trial {
      padding: 11px 18px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s;
      flex: 1;
    }

    .service-cta {
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      color: #fff;
      box-shadow: 0 10px 28px rgba(79,70,229,0.7);
    }

    .service-cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 36px rgba(79,70,229,0.9);
    }

    .service-cta-trial {
      background: linear-gradient(135deg, #facc15 0%, #f97316 100%);
      color: #1f2933;
      box-shadow: 0 10px 28px rgba(234,179,8,0.6);
    }

    .service-cta-trial:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 36px rgba(234,179,8,0.8);
    }

    /* ===== SERVER LIST ===== */
    #serverList {
      display: grid;
      gap: 20px;
    }

    .server-item {
      background: rgba(15,23,42,0.96);
      backdrop-filter: blur(18px);
      border-radius: 20px;
      padding: 20px 22px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      transition: all 0.25s;
      border: 1px solid rgba(148,163,184,0.45);
    }

    .server-item:hover {
      transform: translateX(4px);
      box-shadow: 0 24px 60px rgba(15,23,42,1);
      border-color: rgba(196,181,253,0.8);
    }

    .server-info h4 {
      color: #f9fafb;
      font-size: 17px;
      margin-bottom: 6px;
      font-weight: 700;
    }

    .server-info p {
      font-size: 13px;
      line-height: 1.6;
      color: #9ca3af;
    }

    .server-status {
      padding: 9px 18px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      white-space: nowrap;
    }

    .server-status.online {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: #ecfdf5;
      box-shadow: 0 8px 22px rgba(34,197,94,0.6);
    }

    .server-status.offline {
      background: linear-gradient(135deg, #f97373 0%, #ef4444 100%);
      color: #fef2f2;
      box-shadow: 0 8px 22px rgba(248,113,113,0.6);
    }

    /* ===== FORM CONTAINER ===== */
    .form-container {
      background: rgba(15,23,42,0.96);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 26px 24px;
      max-width: 620px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.45);
    }

    .form-grid {
      display: grid;
      gap: 18px;
    }

    .input-group label {
      display: block;
      margin-bottom: 6px;
      color: #e5e7eb;
      font-weight: 600;
      font-size: 13px;
    }

    .input-group input,
    select {
      width: 100%;
      padding: 11px 14px;
      border: 1px solid #374151;
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.25s;
      background: #020617;
      color: #e5e7eb;
    }

    .input-group input::placeholder {
      color: #6b7280;
    }

    .input-group input:focus,
    select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.5);
      background: #020617;
    }

    select {
      cursor: pointer;
    }

    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.25s;
      position: relative;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn.loading::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      top: 50%;
      right: 20px;
      margin-top: -9px;
      border: 2px solid rgba(255,255,255,0.35);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spinner 0.6s linear infinite;
    }

    @keyframes spinner {
      to { transform: rotate(360deg); }
    }

    .btn-primary {
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      color: #fff;
      box-shadow: 0 12px 32px rgba(79,70,229,0.8);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 16px 42px rgba(79,70,229,1);
    }

    .btn-trial {
      background: linear-gradient(135deg, #facc15 0%, #f97316 100%);
      color: #1f2933;
      box-shadow: 0 12px 32px rgba(234,179,8,0.8);
    }

    .btn-trial:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 16px 42px rgba(234,179,8,1);
    }

    .btn-outline {
      padding: 9px 16px;
      border-radius: 999px;
      border: 1px solid rgba(156,163,175,0.9);
      background: rgba(15,23,42,0.9);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s;
      color: #e5e7eb;
    }

    .btn-outline:hover {
      background: rgba(55,65,81,0.95);
      border-color: #c7d2fe;
      color: #e5e7eb;
      transform: translateY(-1px);
    }

    /* ===== PAYMENT CARD ===== */
    .payment-container {
      background: rgba(15,23,42,0.96);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 26px 24px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      max-width: 700px;
      border: 1px solid rgba(148,163,184,0.45);
    }

    .payment-card {
      display: none;
      border-radius: 20px;
      padding: 24px 22px;
      margin-top: 20px;
      text-align: center;
      background: radial-gradient(circle at top left, rgba(129,140,248,0.25), transparent 60%),
                  radial-gradient(circle at bottom right, rgba(236,72,153,0.25), transparent 60%),
                  rgba(15,23,42,0.98);
      border: 1px solid rgba(196,181,253,0.7);
      box-shadow: 0 18px 45px rgba(15,23,42,0.95);
    }

    .payment-card h4 {
      color: #f9fafb;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: 700;
    }

    .payment-card img {
      max-width: 320px;
      width: 100%;
      margin: 18px 0;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      background: #020617;
    }

    .payment-card p {
      color: #e5e7eb;
      margin-bottom: 16px;
      font-size: 14px;
      font-weight: 500;
    }

    .payment-card a {
      display: inline-block;
      padding: 12px 26px;
      background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);
      color: white;
      text-decoration: none;
      border-radius: 999px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.25s;
      box-shadow: 0 12px 32px rgba(79,70,229,0.85);
    }

    .payment-card a:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 46px rgba(79,70,229,1);
    }

    .mini-box {
      background: #020617;
      color: #e5e7eb;
      border-radius: 12px;
      padding: 10px 12px;
      margin-bottom: 10px;
      font-size: 13px;
      font-family: 'Monaco', 'Courier New', monospace;
      border: 1px solid rgba(55,65,81,0.9);
    }

    .alert-info {
      background: rgba(79,70,229,0.15);
      border-left: 3px solid #6366f1;
      padding: 12px 16px;
      border-radius: 12px;
      color: #e5e7eb;
      font-size: 13px;
      margin-bottom: 16px;
    }

    /* Trial Account Card Styles (disamain gelap) */
    .trial-account-card {
      max-width: 800px;
      margin: 20px auto;
      font-size: 14px;
      line-height: 1.6;
      color: #e5e7eb;
    }

    .info-box {
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.45);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 14px;
      transition: all 0.25s;
    }

    .info-box:hover {
      box-shadow: 0 12px 32px rgba(15,23,42,0.9);
      border-color: #6366f1;
    }

    .info-title {
      font-weight: 600;
      font-size: 14px;
      color: #a5b4fc;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(129,140,248,0.7);
    }

    .info-content {
      color: #e5e7eb;
      font-size: 13px;
    }

    .info-content strong {
      color: #f9fafb;
      font-weight: 600;
    }

    .info-content code {
      background: #020617;
      padding: 3px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #fbbf24;
    }

    .uuid-code {
      display: inline-block;
      max-width: 100%;
      overflow-wrap: break-word;
    }

    .badge {
      display: inline-block;
      padding: 3px 9px;
      font-size: 11px;
      font-weight: 600;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-success {
      background: #22c55e;
      color: #ecfdf5;
    }

    .badge-info {
      background: #0ea5e9;
      color: #ecfeff;
    }

    .badge-warning {
      background: #facc15;
      color: #1f2933;
    }

    .link-container {
      display: flex;
      gap: 8px;
      align-items: stretch;
      margin-top: 8px;
    }

    .config-link {
      flex: 1;
      padding: 9px 10px;
      border: 1px solid #4b5563;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      background: #020617;
      resize: vertical;
      min-height: 60px;
      max-height: 120px;
      word-break: break-all;
      color: #e5e7eb;
    }

    .config-link:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99,102,241,0.5);
    }

    .copy-btn {
      padding: 9px 14px;
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.25s;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .copy-btn:hover {
      background: #4f46e5;
      transform: translateY(-1px);
      box-shadow: 0 8px 22px rgba(79,70,229,0.7);
    }

    .copy-btn.copied {
      background: #22c55e;
    }

    .download-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 9px 14px;
      background: #22c55e;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.25s;
      margin-top: 5px;
    }

    .download-link:hover {
      background: #16a34a;
      transform: translateY(-1px);
      box-shadow: 0 8px 22px rgba(34,197,94,0.7);
      color: white;
    }

    .fas {
      font-size: 13px;
    }

    /* ===== HASIL TRIAL & HASIL AKUN (THEME UNGU DARK) ===== */
    #trialResultCard,
    #topupAccountCard {
      display: none;
      margin-top: 24px;
      border-radius: 24px;
      padding: 22px 20px;
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 45%, #ec4899 100%);
      box-shadow: 0 20px 50px rgba(15,23,42,0.95);
      border: none;
      text-align: left;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .result-header h4 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .result-subtitle {
      margin-top: 6px;
      color: rgba(255,255,255,0.85);
      font-size: 13px;
    }

    #trialResultCard .btn-outline,
    #topupAccountCard .btn-outline {
      border: 1px solid rgba(255,255,255,0.7);
      background: rgba(15,23,42,0.2);
      color: #ffffff;
      font-weight: 600;
      padding: 8px 16px;
    }

    #trialResultCard .btn-outline:hover,
    #topupAccountCard .btn-outline:hover {
      background: rgba(15,23,42,0.4);
      border-color: #ffffff;
      color: #ffffff;
      transform: translateY(-1px);
    }

    #trialResultContent,
    #topupAccountContent {
      margin-top: 10px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 14px;
      padding: 14px;
      font-size: 13px;
      line-height: 1.7;
      font-family: "SF Mono", "Monaco", "Courier New", monospace;
      overflow-x: auto;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.7);
      border: 1px solid rgba(30,64,175,0.8);
    }

    #trialResultContent b,
    #topupAccountContent b {
      color: #a5b4fc;
    }

    #trialResultContent code,
    #topupAccountContent code {
      color: #fbbf24;
      background: rgba(251,191,36,0.12);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    #trialResultContent::-webkit-scrollbar,
    #topupAccountContent::-webkit-scrollbar {
      height: 6px;
    }

    #trialResultContent::-webkit-scrollbar-track,
    #topupAccountContent::-webkit-scrollbar-track {
      background: #020617;
      border-radius: 4px;
    }

    #trialResultContent::-webkit-scrollbar-thumb,
    #topupAccountContent::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 4px;
    }

    #trialResultContent::-webkit-scrollbar-thumb:hover,
    #topupAccountContent::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }

    #trialCopyButtons {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    #trialCopyButtons .btn-outline {
      flex: 1;
      min-width: 120px;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .app-container {
        padding: 16px;
        gap: 16px;
      }

      .services-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .dashboard-header {
        padding: 14px 18px 14px 60px;
      }

      .hamburger {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 4px;
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        border: none;
        padding: 8px;
        cursor: pointer;
        border-radius: 12px;
        box-shadow: 0 10px 24px rgba(79,70,229,0.8);
        z-index: 1001;
      }

      .hamburger span {
        width: 20px;
        height: 2.5px;
        background: white;
        display: block;
        border-radius: 2px;
        transition: all 0.3s;
      }

      .user-email {
        display: none;
      }

      .app-nav {
        position: fixed;
        left: -300px;
        top: 0;
        height: 100vh;
        z-index: 1000;
        transition: left 0.25s;
        width: 260px;
        padding-top: 80px;
      }

      .app-nav.open {
        left: 0;
        box-shadow: 10px 0 40px rgba(0,0,0,0.8);
      }

      .app-container {
        flex-direction: column;
        padding: 12px;
      }

      .page-title {
        font-size: 24px;
      }

      .services-grid {
        grid-template-columns: 1fr;
      }

      .server-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .service-actions {
        flex-direction: column;
      }

      .form-container,
      .payment-container {
        padding: 20px 18px;
      }
    }

    @media (max-width: 480px) {
      .dashboard-header h2 {
        font-size: 18px;
      }

      .logo-icon {
        width: 34px;
        height: 34px;
        font-size: 18px;
      }

      .btn-logout {
        padding: 8px 14px;
        font-size: 12px;
      }

      .page-title {
        font-size: 22px;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(15,23,42,0.9);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(129,140,248,0.7);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(129,140,248,1);
    }
  </style>
</head>
<body>
  <div class="dashboard-header">
    <button class="hamburger" id="btnToggleNav">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <div class="logo-section">
      <div class="logo-icon">üöÄ</div>
      <h2>XT VPN TUNNELING</h2>
    </div>

    <div class="user-info">
      <span class="user-email" id="userEmailHeader">-</span>
      <button class="btn-logout" id="btnLogout">Logout</button>
    </div>
  </div>

  <div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="app-nav">
      <button class="nav-btn active" data-target="overview">üìä Overview</button>
      <button class="nav-btn" data-target="servers">üñ•Ô∏è Server List</button>
      <button class="nav-btn" data-target="create">‚ûï Buat Akun</button>
      <button class="nav-btn" data-target="trial">‚ú® Trial Akun</button>
      <button class="nav-btn" data-target="topup">üí≥ Pembayaran</button>
    </nav>

    <!-- Content Area -->
    <main class="app-content">
      <!-- OVERVIEW PAGE -->
      <div id="app-overview" class="app-page active">
        <h3 class="page-title">Layanan Tersedia</h3>
        <div class="services-grid">
          <div class="service-card">
            <h4>SSH Account</h4>
            <p>Akses SSH untuk tunneling dan remote server. Support Dropbear, OpenSSH, dan WebSocket.</p>
            <div class="service-actions">
              <button class="service-cta" data-create-type="ssh">Buat SSH</button>
              <button class="service-cta-trial" data-trial-type="ssh">Trial SSH</button>
            </div>
          </div>

          <div class="service-card">
            <h4>VMess Account</h4>
            <p>V2Ray VMess protocol dengan enkripsi tinggi. Cocok untuk koneksi cepat dan stabil.</p>
            <div class="service-actions">
              <button class="service-cta" data-create-type="vmess">Buat VMess</button>
              <button class="service-cta-trial" data-trial-type="vmess">Trial VMess</button>
            </div>
          </div>

          <div class="service-card">
            <h4>VLess Account</h4>
            <p>V2Ray VLess protocol tanpa enkripsi tambahan. Performa maksimal untuk streaming.</p>
            <div class="service-actions">
              <button class="service-cta" data-create-type="vless">Buat VLess</button>
              <button class="service-cta-trial" data-trial-type="vless">Trial VLess</button>
            </div>
          </div>

          <div class="service-card">
            <h4>Trojan Account</h4>
            <p>Trojan-GFW protocol dengan TLS. Bypass filtering internet dengan mudah.</p>
            <div class="service-actions">
              <button class="service-cta" data-create-type="trojan">Buat Trojan</button>
              <button class="service-cta-trial" data-trial-type="trojan">Trial Trojan</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SERVERS PAGE -->
      <div id="app-servers" class="app-page">
        <h3 class="page-title">Daftar Server</h3>
        <div id="serverList">
          <p class="muted small">Memuat server...</p>
        </div>
      </div>

      <!-- CREATE ACCOUNT PAGE -->
      <div id="app-create" class="app-page">
        <h3 class="page-title">Buat Akun Baru</h3>
        <div class="form-container">
          <div class="form-grid">
            <div class="input-group">
              <label>Tipe Akun</label>
              <select id="createType">
                <option value="ssh">SSH</option>
                <option value="vmess">VMess</option>
                <option value="vless">VLess</option>
                <option value="trojan">Trojan</option>
              </select>
            </div>

            <div class="input-group">
              <label>Pilih Server</label>
              <select id="createServer">
                <option value="">Memuat server...</option>
              </select>
            </div>

            <div class="input-group">
              <label>Username</label>
              <input type="text" id="createUser" placeholder="username-kamu">
            </div>

            <div class="input-group" id="createPassWrap">
              <label>Password (Khusus SSH)</label>
              <input type="password" id="createPass" placeholder="password">
            </div>

            <div class="input-group">
              <label>Durasi (Hari)</label>
              <select id="createDays">
                <option value="15">15 Hari</option>
                <option value="30">30 Hari</option>
              </select>
            </div>

            <button class="btn btn-primary" id="btnCreate">Buat Akun &amp; Bayar</button>
          </div>
        </div>
      </div>

      <!-- TRIAL PAGE -->
      <div id="app-trial" class="app-page">
        <h3 class="page-title">Trial Akun </h3>
        <div class="form-container">
          <div class="form-grid">
            <p class="small muted">
              Setiap email hanya bisa mengambil trial sekali setiap <b>2 hari</b>.
            </p>

            <div class="input-group">
              <label>Tipe Akun Trial</label>
              <select id="trialType">
                <option value="ssh">SSH</option>
                <option value="vmess">VMess</option>
                <option value="vless">VLess</option>
                <option value="trojan">Trojan</option>
              </select>
            </div>

            <div class="input-group">
              <label>Pilih Server</label>
              <select id="trialServer">
                <option value="">Memuat server...</option>
              </select>
            </div>

            <button class="btn btn-trial" id="btnTrial">Buat Akun Trial (2 hari sekali)</button>
          </div>
        </div>

        <!-- HASIL TRIAL -->
        <div id="trialResultCard" class="payment-container" style="display:none; margin-top:20px;">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;" class="result-header">
            <h4 style="margin:0;">‚úÖ Trial Berhasil Dibuat</h4>
            <button type="button" class="btn-outline" onclick="copyTrialAll()">Salin Semua</button>
          </div>

          <div id="trialResultContent"
               style="margin-top:12px;
                      background:#0f172a;
                      color:#e5e7eb;
                      border-radius:12px;
                      padding:16px;
                      font-size:13px;
                      line-height:1.6;
                      overflow-x:auto;">
          </div>

          <div id="trialCopyButtons"
               style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
          </div>
        </div>
      </div>

      <!-- TOPUP / PAYMENT PAGE -->
      <div id="app-topup" class="app-page">
        <h3 class="page-title">Pembayaran</h3>
        <div class="payment-container">
          <p class="muted small">Setelah membuat akun, QR code dan link pembayaran akan muncul di bawah ini.</p>

          <div id="topupPaymentCard" class="payment-card">
            <h4>Silakan Lakukan Pembayaran</h4>
            <p id="paymentInfo">-</p>
            <img id="qrisImage" src="" alt="QR Code" style="display:none;">
            <br>
            <a id="paymentLink" href="#" target="_blank" style="display:none;">Buka Link Pembayaran</a>
          </div>

          <!-- HASIL AKUN SETELAH BAYAR -->
          <div id="topupAccountCard"
               class="payment-card"
               style="margin-top:20px; display:none;">
            <h4>‚úÖ Akun Berhasil Dibuat</h4>
            <p class="muted small">
              Di bawah ini adalah detail akun yang dibuat otomatis setelah pembayaran berhasil.
            </p>
            <div id="topupAccountContent"
                 style="margin-top:12px;
                        background:#0f172a;
                        color:#e5e7eb;
                        border-radius:12px;
                        padding:16px;
                        font-size:13px;
                        line-height:1.6;
                        overflow-x:auto;">
            </div>
            <button type="button"
                    class="btn-outline"
                    style="margin-top:12px;"
                    onclick="copyTopupAll()">
              Salin Semua
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // =====================================
    // CONFIG
    // =====================================
    const API_BASE = "/api/web";
    const fmtRupiah = (n) => "Rp " + Number(n || 0).toLocaleString("id-ID");

    const ORDER_KEY   = "xt_last_order";          // simpan orderId terakhir
    const ACCOUNT_KEY = "xt_last_paid_account";   // simpan akun yang sudah jadi

    let POLL_TIMER = null;
    let LAST_TRIAL_RAW = "";
    let LAST_TRIAL_PARSED = {};
    let LAST_TOPUP_MESSAGE_RAW = "";

    // ====== SIMPAN / LOAD AKUN BERDASARKAN EMAIL ======
    function saveLastAccountForEmail(email, html, rawText) {
      if (!email || !html) return;
      try {
        const payload = {
          email,
          html,
          raw: rawText || "",
          ts: Date.now(),
        };
        localStorage.setItem(ACCOUNT_KEY, JSON.stringify(payload));
      } catch (e) {
        console.warn("Gagal simpan akun ke localStorage:", e);
      }
    }

    function loadLastAccountForEmail(email) {
      if (!email) return null;
      try {
        const raw = localStorage.getItem(ACCOUNT_KEY);
        if (!raw) return null;

        const data = JSON.parse(raw);
        if (!data || data.email !== email) return null; // beda email => jangan dipakai

        // opsional: expired 7 hari
        const MAX_AGE = 7 * 24 * 60 * 60 * 1000;
        if (Date.now() - (data.ts || 0) > MAX_AGE) return null;

        return data;
      } catch (e) {
        return null;
      }
    }

    function clearLastAccount() {
      try {
        localStorage.removeItem(ACCOUNT_KEY);
      } catch (e) {}
    }

    function lockButton(btn, locked) {
      if (!btn) return;
      btn.disabled = locked;
      btn.classList.toggle("loading", !!locked);
    }

    /**
     * Helper function untuk copy text ke clipboard
     * Digunakan untuk tombol copy pada config link
     */
    function copyToClipboard(button) {
      const container = button.parentElement;
      const textarea = container.querySelector('.config-link');

      if (!textarea) {
        console.error('Textarea tidak ditemukan');
        return;
      }

      textarea.select();
      textarea.setSelectionRange(0, 99999);

      try {
        navigator.clipboard.writeText(textarea.value).then(() => {
          showCopySuccess(button);
        }).catch(err => {
          document.execCommand('copy');
          showCopySuccess(button);
        });
      } catch (err) {
        try {
          document.execCommand('copy');
          showCopySuccess(button);
        } catch (e) {
          console.error('Gagal copy:', e);
          showCopyError(button);
        }
      }
    }

    function showCopySuccess(button) {
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check"></i> Copied!';
      button.classList.add('copied');
      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.classList.remove('copied');
      }, 2000);
    }

    function showCopyError(button) {
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-times"></i> Failed';
      button.style.background = '#dc3545';
      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.style.background = '';
      }, 2000);
    }

    if (typeof module !== 'undefined' && module.exports) {
      module.exports = { copyToClipboard };
    }

    // =====================================
    // NAVIGATION + BACK BUTTON
    // =====================================
    const DEFAULT_PAGE = "overview";

    function openAppPage(name, options = {}) {
      const { pushHistory = true, fromPopstate = false } = options;

      localStorage.setItem("xt_panel_tab", name);

      document.querySelectorAll(".app-page").forEach((p) =>
        p.classList.remove("active")
      );
      const pageEl = document.getElementById("app-" + name);
      if (pageEl) pageEl.classList.add("active");

      document.querySelectorAll(".nav-btn").forEach((btn) =>
        btn.classList.remove("active")
      );
      const activeBtn = document.querySelector(
        '.nav-btn[data-target="' + name + '"]'
      );
      if (activeBtn) activeBtn.classList.add("active");

      const nav = document.querySelector(".app-nav");
      if (nav) nav.classList.remove("open");

      if (pushHistory && !fromPopstate && history.pushState) {
        history.pushState({ page: name }, "", "#" + name);
      }
    }

    function initHistory() {
      const lastTab = localStorage.getItem("xt_panel_tab") || DEFAULT_PAGE;

      openAppPage(lastTab, { pushHistory: false });

      if (history.replaceState) {
        history.replaceState({ page: lastTab }, "", "#" + lastTab);
      }
    }

    window.addEventListener("popstate", (event) => {
      const state = event.state;

      if (state && state.page) {
        openAppPage(state.page, { pushHistory: false, fromPopstate: true });
      } else {
        // biarin browser handle kalau sudah di luar panel
      }
    });

    // =====================================
    // ORDER STORAGE + POLLING
    // =====================================
    function saveLastOrder(orderId, amount) {
      try {
        localStorage.setItem(
          ORDER_KEY,
          JSON.stringify({ orderId, amount, ts: Date.now() })
        );
      } catch (e) {}
    }

    function loadLastOrder() {
      try {
        const raw = localStorage.getItem(ORDER_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch (e) {
        return null;
      }
    }

    function clearLastOrder() {
      try {
        localStorage.removeItem(ORDER_KEY);
      } catch (e) {}
    }

    function copyText(txt) {
      if (!txt) return;
      navigator.clipboard
        .writeText(txt)
        .then(() => alert("‚úÖ Berhasil disalin"))
        .catch(() => alert("Clipboard tidak support di browser ini."));
    }

    function copyTrialAll() {
      if (!LAST_TRIAL_RAW) return;
      copyText(LAST_TRIAL_RAW);
    }

    function copyTopupAll() {
      if (!LAST_TOPUP_MESSAGE_RAW) return;
      copyText(LAST_TOPUP_MESSAGE_RAW);
    }

    async function pollOrderStatusOnce(orderId) {
      if (!orderId) return;
      try {
        const res = await fetch(
          `${API_BASE}/order-status?orderId=${encodeURIComponent(orderId)}`
        );
        const json = await res.json().catch(() => ({}));
        if (!res.ok || !json.ok) return;

        const data = json.data || {};
        if (data.status === "paid") {
          if (POLL_TIMER) {
            clearInterval(POLL_TIMER);
            POLL_TIMER = null;
          }
          clearLastOrder();

          if (data.akun_message && typeof data.akun_message === "string") {
            const card = document.getElementById("topupAccountCard");
            const content = document.getElementById("topupAccountContent");
            if (card && content) {
              content.innerHTML = data.akun_message;

              LAST_TOPUP_MESSAGE_RAW = data.akun_message
                .replace(/<br\s*\/?>/gi, "\n")
                .replace(/<\/p>/gi, "\n\n")
                .replace(/<[^>]+>/g, "")
                .trim();

              const currentEmail = localStorage.getItem("xt_email") || "";
              saveLastAccountForEmail(
                currentEmail,
                data.akun_message,
                LAST_TOPUP_MESSAGE_RAW
              );

              card.style.display = "block";
              card.scrollIntoView({ behavior: "smooth", block: "start" });
            } else {
              alert(
                "Akun berhasil dibuat:\n\n" +
                  data.akun_message.replace(/<[^>]+>/g, "")
              );
            }
          }
        }
      } catch (e) {
        console.warn("Gagal cek status order:", e);
      }
    }

    function startOrderPolling(orderId) {
      if (!orderId) return;
      if (POLL_TIMER) clearInterval(POLL_TIMER);
      POLL_TIMER = setInterval(() => pollOrderStatusOnce(orderId), 5000);
    }

    // =====================================
    // SERVER LIST
    // =====================================
    let cachedServers = [];

    async function loadServersFromApi() {
      try {
        const res = await fetch(API_BASE + "/servers");
        const json = await res.json().catch(() => ({}));
        if (!res.ok || !json.ok) {
          throw new Error(json.error || "Gagal load server.");
        }

        cachedServers = json.data || [];
        renderServers();
        fillServerSelects();
      } catch (e) {
        console.warn("Gagal load servers:", e);
        const wrap = document.getElementById("serverList");
        if (wrap) {
          wrap.innerHTML =
            "<p class='muted small'>Gagal memuat server.</p>";
        }
      }
    }

    function renderServers() {
      const wrap = document.getElementById("serverList");
      if (!wrap) return;

      if (!cachedServers.length) {
        wrap.innerHTML =
          "<p class='muted small'>Server kosong / belum disetting di backend.</p>";
        return;
      }

      wrap.innerHTML = cachedServers
        .map((s) => {
          const isFull = s.penuh;
          const statusText = isFull ? "PENUH" : "TERSEDIA";

          return `
            <div class="server-item">
              <div class="server-info">
                <h4>${s.nama_server}</h4>
                <p class="small muted">${s.lokasi} ‚Ä¢ ${s.isp}</p>
                <p class="small muted">
                  Kuota ${s.quota}GB / hari ‚Ä¢ IP Max ${s.iplimit}
                </p>
              </div>
              <span class="server-status ${isFull ? "offline" : "online"}">
                ${statusText}
              </span>
            </div>
          `;
        })
        .join("");
    }

    function fillServerSelects() {
      const selCreate = document.getElementById("createServer");
      const selTrial  = document.getElementById("trialServer");

      if (!cachedServers.length) {
        if (selCreate) selCreate.innerHTML = "<option value=''>Server kosong</option>";
        if (selTrial)  selTrial.innerHTML  = "<option value=''>Server kosong</option>";
        return;
      }

      const html = cachedServers
        .map((s) => `<option value="${s.id}">${s.nama_server}</option>`)
        .join("");

      if (selCreate) selCreate.innerHTML = html;
      if (selTrial)  selTrial.innerHTML  = html;
    }

    // =====================================
    // PASSWORD FIELD VISIBILITY
    // =====================================
    const typeSelect        = document.getElementById("createType");
    const passwordFieldWrap = document.getElementById("createPassWrap");
    const trialTypeSelect   = document.getElementById("trialType");
    const trialPassWrap     = document.getElementById("trialPassWrap");

    function updatePasswordVisibility() {
      if (!typeSelect || !passwordFieldWrap) return;
      const t = typeSelect.value.toLowerCase();
      passwordFieldWrap.style.display = t === "ssh" ? "block" : "none";
    }

    function updateTrialPasswordVisibility() {
      if (!trialTypeSelect || !trialPassWrap) return;
      const t = trialTypeSelect.value.toLowerCase();
      trialPassWrap.style.display = t === "ssh" ? "block" : "none";
    }

    // =====================================
    // TRIAL RESULT + COPY HELPER
    // =====================================
    function showTrialResult(messageHtml) {
      const card    = document.getElementById("trialResultCard");
      const content = document.getElementById("trialResultContent");
      const btnBox  = document.getElementById("trialCopyButtons");

      if (!card || !content || !btnBox) {
        alert(
          "Trial berhasil dibuat:\n\n" +
          messageHtml.replace(/<[^>]+>/g, "")
        );
        return;
      }

      LAST_TRIAL_RAW = messageHtml
        .replace(/<br\s*\/?>/gi, "\n")
        .replace(/<\/p>/gi, "\n\n")
        .replace(/<[^>]+>/g, "")
        .trim();

      content.innerHTML = messageHtml;

      const find = (label) => {
        const r = new RegExp(
          `<b>${label}<\\/b>\\s*:?\\s*<code>(.*?)<\\/code>`,
          "i"
        );
        const m = messageHtml.match(r);
        return m ? m[1] : "";
      };

      LAST_TRIAL_PARSED = {
        username: find("Username"),
        password: find("Password"),
        uuid:     find("UUID"),
        domain:   find("Domain"),
      };

      btnBox.innerHTML = "";

      if (LAST_TRIAL_PARSED.username) {
        btnBox.innerHTML += `
          <button type="button" class="btn-outline"
            onclick="copyText('${LAST_TRIAL_PARSED.username}')">
            Copy Username
          </button>`;
      }

      if (LAST_TRIAL_PARSED.password) {
        btnBox.innerHTML += `
          <button type="button" class="btn-outline"
            onclick="copyText('${LAST_TRIAL_PARSED.password}')">
            Copy Password
          </button>`;
      }

      if (LAST_TRIAL_PARSED.uuid) {
        btnBox.innerHTML += `
          <button type="button" class="btn-outline"
            onclick="copyText('${LAST_TRIAL_PARSED.uuid}')">
            Copy UUID
          </button>`;
      }

      card.style.display = "block";
      card.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // =====================================
    // ON LOAD
    // =====================================
    window.addEventListener("load", () => {
      const email = localStorage.getItem("xt_email");
      const pass  = localStorage.getItem("xt_pass");

      if (!email || !pass) {
        window.location.href = "login.html";
        return;
      }

      const headerEmailEl = document.getElementById("userEmailHeader");
      if (headerEmailEl) headerEmailEl.innerText = email;

      const btnLogout = document.getElementById("btnLogout");
      if (btnLogout) {
        btnLogout.onclick = () => {
          localStorage.removeItem("xt_email");
          localStorage.removeItem("xt_pass");
          localStorage.removeItem("xt_panel_tab");
          clearLastOrder();
          clearLastAccount();
          window.location.href = "login.html";
        };
      }

      document.querySelectorAll(".nav-btn").forEach((btn) => {
        btn.onclick = () => openAppPage(btn.dataset.target);
      });

      const btnToggleNav = document.getElementById("btnToggleNav");
      if (btnToggleNav) {
        btnToggleNav.onclick = () => {
          const nav = document.querySelector(".app-nav");
          if (nav) nav.classList.toggle("open");
        };
      }

      loadServersFromApi();

      updatePasswordVisibility();
      if (typeSelect) {
        typeSelect.addEventListener("change", updatePasswordVisibility);
      }
      updateTrialPasswordVisibility();
      if (trialTypeSelect) {
        trialTypeSelect.addEventListener("change", updateTrialPasswordVisibility);
      }

      document.querySelectorAll(".service-cta").forEach((btn) => {
        btn.addEventListener("click", () => {
          const t = btn.dataset.createType || "ssh";
          openAppPage("create");
          const sel = document.getElementById("createType");
          if (sel) {
            sel.value = t;
            updatePasswordVisibility();
          }
        });
      });

      document.querySelectorAll(".service-cta-trial").forEach((btn) => {
        btn.addEventListener("click", () => {
          const t = btn.dataset.trialType || "ssh";
          openAppPage("trial");
          const sel =
            document.getElementById("trialType") ||
            document.getElementById("createType");
          if (sel) {
            sel.value = t;
            updateTrialPasswordVisibility();
          }
          const trialBtn = document.getElementById("btnTrial");
          if (trialBtn) {
            trialBtn.scrollIntoView({ behavior: "smooth", block: "center" });
          }
        });
      });

      const btnCreate = document.getElementById("btnCreate");
      if (btnCreate) {
        btnCreate.onclick = async (ev) => {
          const btn = ev.currentTarget;
          const type = document.getElementById("createType").value;
          const serverId = parseInt(
            document.getElementById("createServer").value,
            10
          );
          const username = document
            .getElementById("createUser")
            .value.trim();
          const password = document.getElementById("createPass")
            ? document.getElementById("createPass").value.trim()
            : "";
          const days = parseInt(
            document.getElementById("createDays").value,
            10
          );
          const userEmail = localStorage.getItem("xt_email") || "";

          if (!userEmail) {
            alert("Kamu harus login terlebih dahulu.");
            window.location.href = "index.html";
            return;
          }
          if (!serverId || !username || !days) {
            alert("Lengkapi semua form (server, username, hari).");
            return;
          }
          if (type === "ssh" && !password) {
            alert("Password SSH wajib diisi untuk akun SSH.");
            return;
          }
          if (days !== 15 && days !== 30) {
            alert("Untuk panel web hanya tersedia paket 15 atau 30 hari.");
            return;
          }

          lockButton(btn, true);

          try {
            const res = await fetch(API_BASE + "/create-order", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                email: userEmail,
                type,
                serverId,
                username,
                days,
                password,
              }),
            });

            const json = await res.json().catch(() => ({}));
            if (!res.ok || !json.ok) {
              throw new Error(json.error || "Gagal membuat order.");
            }

            const data = json.data || {};
            const card = document.getElementById("topupPaymentCard");
            const img = document.getElementById("qrisImage");
            const infoEl = document.getElementById("paymentInfo");
            const linkEl = document.getElementById("paymentLink");

            if (card && infoEl) {
              infoEl.textContent = `Order ID: ${
                data.orderId || "-"
              } ‚Ä¢ Nominal: ${fmtRupiah(data.amount || 0)}`;

              if (img) {
                let qrUrl =
                  data.qrImageBase64 ||
                  data.qrImageUrl ||
                  data.qrisImageUrl ||
                  data.qr_url ||
                  data.qris_image ||
                  data.qrisImage ||
                  data.qrImage ||
                  "";

                if (
                  qrUrl &&
                  !qrUrl.startsWith("http") &&
                  !qrUrl.startsWith("data:")
                ) {
                  qrUrl = "data:image/png;base64," + qrUrl;
                }

                if (qrUrl) {
                  img.src = qrUrl;
                  img.style.display = "block";
                } else {
                  img.style.display = "none";
                }
              }

              if (linkEl) {
                if (data.paymentUrl) {
                  linkEl.href = data.paymentUrl;
                  linkEl.style.display = "inline-block";
                } else {
                  linkEl.style.display = "none";
                }
              }

              card.style.display = "block";
            }

            saveLastOrder(data.orderId, data.amount);
            startOrderPolling(data.orderId);

            openAppPage("topup");

            alert(
              "Order berhasil dibuat.\nSilakan lakukan pembayaran menggunakan QR / link yang tampil. Akun akan dibuat otomatis setelah pembayaran berhasil."
            );
          } catch (e) {
            alert(e.message || "Gagal membuat order pembayaran.");
          } finally {
            lockButton(btn, false);
          }
        };
      }

      const btnTrial = document.getElementById("btnTrial");
      if (btnTrial) {
        btnTrial.onclick = async (ev) => {
          const btn = ev.currentTarget;

          const userEmail = localStorage.getItem("xt_email") || "";
          if (!userEmail) {
            alert("Kamu harus login terlebih dahulu.");
            window.location.href = "login.html";
            return;
          }

          const typeEl =
            document.getElementById("trialType") ||
            document.getElementById("createType");
          const serverEl =
            document.getElementById("trialServer") ||
            document.getElementById("createServer");
          const usernameEl =
            document.getElementById("trialUsername") ||
            document.getElementById("createUser");
          const passwordEl =
            document.getElementById("trialPassword") ||
            document.getElementById("createPass");

          const type = typeEl ? typeEl.value : "";
          const serverId = serverEl ? parseInt(serverEl.value, 10) : 0;
          const username = usernameEl ? usernameEl.value.trim() : "";
          const password = passwordEl ? passwordEl.value.trim() : "";

          if (!type || !serverId) {
            alert("Data trial tidak lengkap (tipe / server).");
            return;
          }

          lockButton(btn, true);
          try {
            const res = await fetch(API_BASE + "/trial", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                email: userEmail,
                type,
                serverId,
                username,
                password,
              }),
            });

            const json = await res.json().catch(() => ({}));

            if (!res.ok || !json.ok) {
              if (res.status === 429 && json.error) {
                throw new Error(json.error);
              }
              throw new Error(json.error || "Gagal membuat akun trial.");
            }

            const data = json.data || {};
            if (data.message && typeof data.message === "string") {
              showTrialResult(data.message);
            } else {
              alert(
                "Trial berhasil dibuat.\n\n" +
                  JSON.stringify(data, null, 2)
              );
            }
          } catch (e) {
            alert(e.message || "Gagal membuat akun trial.");
          } finally {
            lockButton(btn, false);
          }
        };
      }

      // Inisialisasi history + tab pertama
      initHistory();

      // Restore order jika ada
      const lastOrder = loadLastOrder();
      if (lastOrder && lastOrder.orderId) {
        const card = document.getElementById("topupPaymentCard");
        const infoEl = document.getElementById("paymentInfo");
        if (card && infoEl) {
          infoEl.textContent = `Order ID: ${
            lastOrder.orderId
          } ‚Ä¢ Nominal: ${fmtRupiah(lastOrder.amount || 0)}`;
          card.style.display = "block";
        }
        openAppPage("topup");
        startOrderPolling(lastOrder.orderId);
      }

      // üîÅ RESTORE AKUN TERSIMPAN (KHUSUS EMAIL INI)
      try {
        const savedAcc = loadLastAccountForEmail(email);
        if (savedAcc && savedAcc.html) {
          const card = document.getElementById("topupAccountCard");
          const content = document.getElementById("topupAccountContent");

          if (card && content) {
            content.innerHTML = savedAcc.html;
            card.style.display = "block";

            LAST_TOPUP_MESSAGE_RAW = (savedAcc.raw || savedAcc.html)
              .replace(/<br\s*\/?>/gi, "\n")
              .replace(/<\/p>/gi, "\n\n")
              .replace(/<[^>]+>/g, "")
              .trim();

            openAppPage("topup");
          }
        }
      } catch (e) {
        console.warn("Gagal restore akun tersimpan:", e);
      }
    });
  </script>
</body>
</html>
